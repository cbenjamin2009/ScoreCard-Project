{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///home/master/Development/ScoreCard%20Project/lib/scorecard.js"],"sourcesContent":["import crypto from 'node:crypto';\nimport fs from 'node:fs';\nimport path from 'node:path';\nimport * as XLSX from 'xlsx';\n\nconst CADENCE_CONFIG = {\n  weekly: {\n    label: 'Weekly',\n    defaultSheet: 'EOS 2026',\n    sheetEnv: 'SCORECARD_WEEKLY_SHEET',\n    rollingPeriods: 4,\n  },\n  monthly: {\n    label: 'Monthly',\n    defaultSheet: 'IT Monthly 2026',\n    sheetEnv: 'SCORECARD_MONTHLY_SHEET',\n    rollingPeriods: null,\n  },\n};\nconst DEFAULT_CACHE_DIR = '.cache';\nconst CACHE_FILE_PREFIX = 'scorecard';\nconst CACHE_MODE_OFF = 'off';\n\nconst sanitizeNumber = (value) => {\n  if (value === undefined || value === null) return null;\n  if (typeof value === 'number') return Number.isNaN(value) ? null : value;\n  const cleaned = String(value).replace(/[^0-9.-]/g, '');\n  if (!cleaned) return null;\n  const parsed = Number.parseFloat(cleaned);\n  return Number.isNaN(parsed) ? null : parsed;\n};\n\nconst slugify = (value) =>\n  String(value)\n    .trim()\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '');\n\nconst parsePanicCell = (cellValue) => {\n  if (!cellValue) {\n    return { text: '', threshold: null, comparator: null, isPercent: false };\n  }\n\n  const text = String(cellValue).trim();\n  const cleaned = text.replace(/^p:\\s*/i, '').trim();\n  const lower = cleaned.toLowerCase();\n  const comparator = /more\\s+than|greater\\s+than|above/.test(lower)\n    ? 'more'\n    : /less\\s+than|below/.test(lower)\n      ? 'less'\n      : null;\n  const isPercent = /%/.test(cleaned);\n  const rawThreshold = sanitizeNumber(cleaned);\n  const threshold = rawThreshold === null ? null : isPercent ? rawThreshold / 100 : rawThreshold;\n\n  if (comparator === null && threshold === 0) {\n    return { text, threshold, comparator: 'more', isPercent };\n  }\n\n  return { text, threshold, comparator, isPercent };\n};\n\nconst getCacheSettings = () => {\n  const mode = (process.env.SCORECARD_CACHE_MODE || 'file').trim().toLowerCase();\n  const enabled = mode !== CACHE_MODE_OFF;\n  const dirSetting = process.env.SCORECARD_CACHE_DIR?.trim() || DEFAULT_CACHE_DIR;\n  const dir = path.isAbsolute(dirSetting) ? dirSetting : path.join(process.cwd(), dirSetting);\n  return { enabled, dir };\n};\n\nconst getCacheContext = (workbookPath, sheetName) => {\n  const settings = getCacheSettings();\n  if (!settings.enabled) {\n    return { enabled: false };\n  }\n\n  const hash = crypto.createHash('sha1').update(`${workbookPath}::${sheetName}`).digest('hex');\n  const filePath = path.join(settings.dir, `${CACHE_FILE_PREFIX}-${hash}.json`);\n\n  return { enabled: true, filePath };\n};\n\nconst readCachePayload = (context, workbookMeta) => {\n  if (!context.enabled || !context.filePath) return null;\n  if (!fs.existsSync(context.filePath)) return null;\n\n  try {\n    const raw = fs.readFileSync(context.filePath, 'utf8');\n    const parsed = JSON.parse(raw);\n    const meta = parsed.meta || {};\n\n    if (\n      meta.sourceMtimeMs !== workbookMeta.mtimeMs ||\n      meta.workbookPath !== workbookMeta.path ||\n      meta.sheetName !== workbookMeta.sheet\n    ) {\n      return null;\n    }\n\n    return parsed.payload;\n  } catch {\n    return null;\n  }\n};\n\nconst writeCachePayload = (context, workbookMeta, payload) => {\n  if (!context.enabled || !context.filePath) return;\n\n  try {\n    fs.mkdirSync(path.dirname(context.filePath), { recursive: true });\n    const cacheBlob = {\n      meta: {\n        workbookPath: workbookMeta.path,\n        sheetName: workbookMeta.sheet,\n        sourceMtimeMs: workbookMeta.mtimeMs,\n        cachedAt: new Date().toISOString(),\n      },\n      payload,\n    };\n    fs.writeFileSync(context.filePath, JSON.stringify(cacheBlob, null, 2));\n  } catch (error) {\n    console.warn('[scorecard-cache] Unable to persist cache:', error.message);\n  }\n};\n\nexport const resolveWorkbookPath = () => {\n  const configured = process.env.SOURCE_SPREADSHEET?.trim();\n  const defaultPath = 'assets/IT Scorecard 2026.xlsx';\n  const candidate = configured || defaultPath;\n  return path.isAbsolute(candidate) ? candidate : path.join(process.cwd(), candidate);\n};\n\nconst formatPeriodLabel = (value, cadence) => {\n  if (value === undefined || value === null || value === '') return '';\n  if (value instanceof Date && !Number.isNaN(value.getTime())) {\n    return value.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n  }\n  if (typeof value === 'number') {\n    const parsed = XLSX.SSF.parse_date_code(value);\n    if (parsed?.y && parsed?.m && parsed?.d) {\n      const date = new Date(Date.UTC(parsed.y, parsed.m - 1, parsed.d));\n      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n    }\n  }\n  const text = String(value).trim();\n  if (cadence === 'monthly' && text.length > 3) {\n    return text;\n  }\n  return text;\n};\n\nconst parsePeriodSortKey = (value) => {\n  if (value instanceof Date && !Number.isNaN(value.getTime())) {\n    return value.getTime();\n  }\n  if (typeof value === 'number') {\n    const parsed = XLSX.SSF.parse_date_code(value);\n    if (parsed?.y && parsed?.m && parsed?.d) {\n      return Date.UTC(parsed.y, parsed.m - 1, parsed.d);\n    }\n  }\n  return null;\n};\n\nconst findHeaderIndex = (rows) =>\n  rows.findIndex((row) => {\n    const metricLabel = String(row?.[1] || '').trim().toLowerCase();\n    const panicLabel = String(row?.[3] || '').trim().toLowerCase();\n    return metricLabel === 'metric' && panicLabel.includes('panic');\n  });\n\nconst findLastDataColumn = (rows, headerIndex, startIndex) => {\n  let lastIndex = startIndex;\n  for (let rowIndex = headerIndex + 1; rowIndex < rows.length; rowIndex += 1) {\n    const row = rows[rowIndex];\n    if (!row) continue;\n    for (let colIndex = startIndex; colIndex < row.length; colIndex += 1) {\n      const cell = row[colIndex];\n      if (cell !== null && cell !== undefined && cell !== '') {\n        lastIndex = Math.max(lastIndex, colIndex);\n      }\n    }\n  }\n  return lastIndex;\n};\n\nconst buildColumnWindow = (headerRow, rows, headerIndex, cadenceConfig) => {\n  const panicIndex = headerRow.findIndex((cell) => String(cell || '').toLowerCase().includes('panic'));\n  const valueStart = panicIndex === -1 ? 4 : panicIndex + 1;\n  let valueEnd = headerRow.length - 1;\n\n  const averageIndex = headerRow.findIndex((cell) =>\n    String(cell || '').trim().toLowerCase().startsWith('average'),\n  );\n  if (averageIndex !== -1) {\n    valueEnd = averageIndex - 1;\n  }\n\n  const lastDataIndex = findLastDataColumn(rows, headerIndex, valueStart);\n  if (lastDataIndex >= valueStart) {\n    valueEnd = Math.min(valueEnd, lastDataIndex);\n  }\n\n  if (cadenceConfig?.rollingPeriods) {\n    const windowStart = Math.max(valueStart, valueEnd - cadenceConfig.rollingPeriods + 1);\n    return { valueStart: windowStart, valueEnd };\n  }\n\n  return { valueStart, valueEnd };\n};\n\nconst extractMetricRows = (rows, cadence) => {\n  const headerIndex = findHeaderIndex(rows);\n  if (headerIndex === -1) {\n    throw new Error('Unable to locate the \"Metric\" header row inside the worksheet.');\n  }\n\n  const headerRow = rows[headerIndex];\n  const cadenceConfig = CADENCE_CONFIG[cadence] || CADENCE_CONFIG.weekly;\n  const { valueStart, valueEnd } = buildColumnWindow(headerRow, rows, headerIndex, cadenceConfig);\n  const columns = [];\n  for (let colIndex = valueStart; colIndex <= valueEnd; colIndex += 1) {\n    const label = headerRow[colIndex];\n    const formatted = formatPeriodLabel(label, cadence);\n    columns.push({\n      colIndex,\n      label: formatted || (cadence === 'monthly' ? `Month ${colIndex - valueStart + 1}` : `Week ${colIndex - valueStart + 1}`),\n      sortKey: cadence === 'weekly' ? parsePeriodSortKey(label) : null,\n    });\n  }\n\n  let orderedColumns = columns;\n  if (cadence === 'weekly' && columns.length > 1 && columns.every((col) => col.sortKey !== null)) {\n    orderedColumns = [...columns].sort((a, b) => a.sortKey - b.sortKey);\n  }\n\n  const periodLabels = orderedColumns.map((col) => col.label);\n\n  const metrics = [];\n  let lastCategory = '';\n\n  for (let rowIndex = headerIndex + 1; rowIndex < rows.length; rowIndex += 1) {\n    const row = rows[rowIndex];\n    if (!row || row.every((cell) => cell === undefined || cell === null || cell === '')) {\n      continue;\n    }\n\n    if (row[0]) {\n      lastCategory = String(row[0]).trim();\n    }\n\n    const metricName = row[1];\n    if (!metricName) continue;\n\n    const trimmedMetric = String(metricName).trim();\n    const category = lastCategory || 'General';\n    const description = row[2] ? String(row[2]).trim() : '';\n    const panic = parsePanicCell(row[3]);\n\n    const series = orderedColumns.map((col) => {\n      const rawValue = row[col.colIndex];\n      return {\n        period: col.label,\n        raw: rawValue === undefined || rawValue === null ? null : String(rawValue),\n        value: sanitizeNumber(rawValue),\n      };\n    });\n\n    const latestPoint = [...series].reverse().find((point) => point.raw !== null && point.raw !== '');\n    const fallbackPeriod = periodLabels[periodLabels.length - 1] || 'Latest';\n    const latest = latestPoint\n      ? { ...latestPoint, display: latestPoint.raw }\n      : { period: fallbackPeriod, raw: null, value: null, display: 'â€”' };\n\n    let status = 'unknown';\n    if (latest.value !== null && panic.threshold !== null && panic.comparator) {\n      if (panic.comparator === 'more') {\n        status = latest.value > panic.threshold ? 'at-risk' : 'on-track';\n      } else if (panic.comparator === 'less') {\n        status = latest.value < panic.threshold ? 'at-risk' : 'on-track';\n      }\n    }\n\n    metrics.push({\n      id: slugify(`${category}-${trimmedMetric}`),\n      category,\n      name: trimmedMetric,\n      description,\n      panic,\n      series,\n      latest,\n      status,\n    });\n  }\n\n  return { metrics, periodLabels };\n};\n\nconst resolveCadenceConfig = (cadence) => {\n  const key = cadence && CADENCE_CONFIG[cadence] ? cadence : 'weekly';\n  const config = CADENCE_CONFIG[key];\n  const sheetName = process.env[config.sheetEnv]?.trim() || config.defaultSheet;\n  return { key, sheetName, label: config.label };\n};\n\nexport const getScorecardData = ({ cadence = 'weekly' } = {}) => {\n  const workbookPath = resolveWorkbookPath();\n  if (!fs.existsSync(workbookPath)) {\n    throw new Error(`Spreadsheet not found at ${workbookPath}. Update SOURCE_SPREADSHEET to a valid file.`);\n  }\n\n  const { key: cadenceKey, sheetName, label: cadenceLabel } = resolveCadenceConfig(cadence);\n  const workbookStats = fs.statSync(workbookPath);\n  const workbookMeta = { path: workbookPath, sheet: sheetName, mtimeMs: workbookStats.mtimeMs };\n  const cacheContext = getCacheContext(workbookPath, sheetName);\n\n  const cachedPayload = readCachePayload(cacheContext, workbookMeta);\n  if (cachedPayload) {\n    return {\n      ...cachedPayload,\n      cadence: cadenceKey,\n      cadenceLabel,\n      cacheInfo: {\n        status: 'hit',\n        mode: cacheContext.enabled ? 'file' : 'off',\n        filePath: cacheContext.filePath || null,\n      },\n      lastUpdatedAt: new Date(workbookStats.mtime).toISOString(),\n    };\n  }\n\n  const workbook = XLSX.readFile(workbookPath, { cellDates: true });\n  const worksheet = workbook.Sheets[sheetName];\n\n  if (!worksheet) {\n    throw new Error(`Worksheet \"${sheetName}\" was not found in ${workbookPath}.`);\n  }\n\n  const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: null });\n  const { metrics, periodLabels } = extractMetricRows(rows, cadenceKey);\n\n  const payload = {\n    sheetName,\n    source: workbookPath,\n    generatedAt: new Date().toISOString(),\n    cadence: cadenceKey,\n    cadenceLabel,\n    periods: periodLabels,\n    metrics,\n  };\n\n  writeCachePayload(cacheContext, workbookMeta, payload);\n\n  return {\n    ...payload,\n    cacheInfo: {\n      status: cacheContext.enabled ? 'miss' : 'disabled',\n      mode: cacheContext.enabled ? 'file' : 'off',\n      filePath: cacheContext.filePath || null,\n    },\n    lastUpdatedAt: new Date(workbookStats.mtime).toISOString(),\n  };\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 414, "column": 0}, "map": {"version":3,"sources":["file:///home/master/Development/ScoreCard%20Project/pages/api/download.js"],"sourcesContent":["import fs from 'node:fs';\nimport path from 'node:path';\nimport { resolveWorkbookPath } from '@/lib/scorecard';\n\nexport default function handler(req, res) {\n  try {\n    const workbookPath = resolveWorkbookPath();\n    if (!fs.existsSync(workbookPath)) {\n      return res.status(404).json({ message: 'Workbook not found.' });\n    }\n\n    const fileName = path.basename(workbookPath);\n    const stats = fs.statSync(workbookPath);\n    if (req.query?.meta) {\n      return res.status(200).json({\n        name: fileName,\n        updatedAt: stats.mtime.toISOString(),\n      });\n    }\n    res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n    res.setHeader('Content-Disposition', `attachment; filename=\"${fileName}\"`);\n    fs.createReadStream(workbookPath).pipe(res);\n  } catch (error) {\n    res.status(500).json({ message: error.message });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEe,SAAS,QAAQ,GAAG,EAAE,GAAG;IACtC,IAAI;QACF,MAAM,eAAe,IAAA,gIAAmB;QACxC,IAAI,CAAC,wHAAE,CAAC,UAAU,CAAC,eAAe;YAChC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAAsB;QAC/D;QAEA,MAAM,WAAW,4HAAI,CAAC,QAAQ,CAAC;QAC/B,MAAM,QAAQ,wHAAE,CAAC,QAAQ,CAAC;QAC1B,IAAI,IAAI,KAAK,EAAE,MAAM;YACnB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAC1B,MAAM;gBACN,WAAW,MAAM,KAAK,CAAC,WAAW;YACpC;QACF;QACA,IAAI,SAAS,CAAC,gBAAgB;QAC9B,IAAI,SAAS,CAAC,uBAAuB,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC;QACzE,wHAAE,CAAC,gBAAgB,CAAC,cAAc,IAAI,CAAC;IACzC,EAAE,OAAO,OAAO;QACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS,MAAM,OAAO;QAAC;IAChD;AACF"}}]
}